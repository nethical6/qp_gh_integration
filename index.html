<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Commit-Block Quest â€“ Setup</title>
    <style>
      :root {
        --primary: #000000;
        --primary-light: #333333;
        --bg: #ffffff;
        --text: #1a1a1a;
        --border: #e0e0e0;
        --accent: #f5f5f5;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        padding: 2rem;
        max-width: 540px;
        margin: 0 auto;
        background: var(--bg);
        color: var(--text);
        line-height: 1.6;
      }
      .step {
        margin-bottom: 2.5rem;
      }
      .step h2 {
        margin: 0 0 1rem;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--primary-light);
        font-weight: 600;
      }
      input[type="text"],
      input[type="password"],
      input[type="number"] {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid var(--border);
        border-radius: 6px;
        margin: 0.25rem 0;
        font-size: 0.9375rem;
        background: var(--accent);
        transition: border-color 0.2s, background 0.2s;
      }
      input:focus {
        outline: none;
        border-color: var(--primary);
        background: var(--bg);
      }
      .day-button {
        padding: 0.5rem 1rem;
        border: 1px solid var(--border);
        background: var(--bg);
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.875rem;
        transition: all 0.2s;
      }
      .day-button:hover {
        background: var(--accent);
      }
      .day-button.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
      }
      #generateBtn {
        background: var(--primary);
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 6px;
        font-size: 0.9375rem;
        cursor: pointer;
        width: 100%;
        transition: transform 0.2s;
        font-weight: 500;
      }
      #generateBtn:hover {
        transform: translateY(-1px);
      }
      #jsonOutput {
        background: var(--accent);
        color: var(--text);
        padding: 1.5rem;
        border-radius: 6px;
        margin-top: 2rem;
        border: 1px solid var(--border);
      }
      #copyBtn {
        background: var(--bg);
        color: var(--primary);
        border: 1px solid var(--primary);
        padding: 0.75rem 1rem;
        border-radius: 6px;
        margin-top: 1rem;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
      }
      #copyBtn:hover {
        background: var(--primary);
        color: white;
      }
      #quest-header {
        text-align: left;
        margin-bottom: 3rem;
      }
      #quest-header h1 {
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0 0 0.5rem;
      }
      #quest-header p {
        color: var(--primary-light);
        margin: 0 0 1.5rem;
      }
      .input-group {
        margin-bottom: 1.5rem;
      }
      .input-group label {
        display: block;
        margin-bottom: 0.375rem;
        font-size: 0.875rem;
        color: var(--primary-light);
        font-weight: 500;
      }
      small {
        display: block;
        margin-top: 0.5rem;
        color: var(--primary-light);
        font-size: 0.75rem;
      }
      #days-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }
      .disclaimer {
        font-size: 0.75rem;
        color: var(--primary-light);
        line-height: 1.5;
        background: var(--accent);
        padding: 1rem;
        border-radius: 6px;
        margin: 1.5rem 0;
      }
      a {
        color: var(--primary);
        text-decoration: none;
        border-bottom: 1px solid currentColor;
      }
      a:hover {
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <div id="quest-container">
      <div id="quest-header">
        <h1>Commit-Block Quest</h1>
        <p>Block distractions until you push X commits on GitHub</p>
        <a href="https://github.com/nethical6/qp_gh_integration">View source on GitHub</a>
        <div class="disclaimer">
          This project uses the GitHub API and is not affiliated with, endorsed by, or sponsored by GitHub or QuestPhone. All trademarks belong to their respective owners.
        </div>
      </div>

      <!-- 1. Quest Title -->
      <div class="step">
        <h2>1. Quest Title</h2>
        <input
          type="text"
          id="inputQuestTitle"
          placeholder="e.g. Code Sprint"
          value=""
        />
      </div>

      <!-- 2. Active Days -->
      <div class="step">
        <h2>2. Active Days</h2>
        <div id="days-container">
          <button class="day-button" data-day="MON">Mon</button>
          <button class="day-button" data-day="TUE">Tue</button>
          <button class="day-button" data-day="WED">Wed</button>
          <button class="day-button" data-day="THU">Thu</button>
          <button class="day-button" data-day="FRI">Fri</button>
          <button class="day-button" data-day="SAT">Sat</button>
          <button class="day-button" data-day="SUN">Sun</button>
        </div>
      </div>

      <!-- 4. Custom Settings -->
      <div class="step">
        <h2>4. Settings</h2>
        <div class="input-group">
          <label for="githubUser">GitHub Username</label>
          <input
            type="text"
            id="githubUser"
            placeholder="your-github-username"
            required
          />
        </div>
        <div class="input-group">
          <label for="githubToken">GitHub Token</label>
          <input
            type="password"
            id="githubToken"
            placeholder="github_pat_..."
            required
          />
          <small
            >Create a
            <a href="https://github.com/settings/tokens" target="_blank"
              >Personal Access Token</a
            >
            with 'repo' scope</small
          >
          <p>
            <small
              >Keep your generated config secure and do not share it anywhere
              except questphone.</small
            >
          </p>
        </div>
        <div class="input-group">
          <label for="requiredCommits">Required Commits Everyday</label>
          <input type="number" id="requiredCommits" min="1" value="3" />
        </div>
      </div>

      <!-- 5. Generate -->
      <div class="step">
        <button id="generateBtn">Generate Configuration</button>
      </div>

      <!-- JSON Output -->
      <div id="jsonOutput" style="display: none">
        <h3>Copy the JSON below and paste it into QuestPhone</h3>
        <pre id="jsonContent"></pre>
        <button id="copyBtn">Copy JSON</button>
      </div>
    </div>

    <script>
      const selectedDays = new Set();

      document.querySelectorAll(".day-button").forEach((btn) => {
        btn.addEventListener("click", () => {
          const d = btn.dataset.day;
          if (selectedDays.has(d)) {
            selectedDays.delete(d);
            btn.classList.remove("active");
          } else {
            selectedDays.add(d);
            btn.classList.add("active");
          }
        });
      });

      function generateUUID() {
        return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (c) => {
          const r = (Math.random() * 16) | 0;
          return (c === "x" ? r : (r & 0x3) | 0x8).toString(16);
        });
      }

      document.getElementById("generateBtn").addEventListener("click", () => {
        const title =
          document.getElementById("inputQuestTitle").value.trim() ||
          "Commit-Block Quest";
        const githubUser = document.getElementById("githubUser").value.trim();
        const requiredCommits =
          document.getElementById("requiredCommits").value;

        if (!githubUser) {
          alert("GitHub username is required");
          return;
        }
        if (selectedDays.size === 0) {
          alert("Select at least one active day");
          return;
        }

        const startHour = 0;
        const endHour = 24;

        const githubToken = document.getElementById("githubToken").value.trim();
        if (!githubToken) {
          alert("GitHub token is required");
          return;
        }

        const questJson = JSON.stringify({
          webviewUrl:
            location.origin +
            location.pathname.replace("index.html", "view.html"), // same repo
          githubUser,
          githubToken,
          requiredCommits: requiredCommits.toString(),
        });

        const config = {
          title,
          selected_days: Array.from(selectedDays),
          time_range: [startHour, endHour],
          id: generateUUID(),
          quest_json: questJson,
          integration_id: "EXTERNAL_INTEGRATION",
        };

        const pretty = JSON.stringify(config, null, 2);
        document.getElementById("jsonContent").textContent = pretty;
        document.getElementById("jsonOutput").style.display = "block";
      });

      document.getElementById("copyBtn").addEventListener("click", () => {
        navigator.clipboard
          .writeText(document.getElementById("jsonContent").textContent)
          .then(() => alert("Copied! Paste into QuestPhone."))
          .catch(() => alert("Copy failed"));
      });
    </script>
  </body>
</html>
