<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Commit-Block Quest â€“ Setup</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --bg: #f8fafc;
      --text: #1e293b;
      --border: #e2e8f0;
    }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      padding: 2rem;
      max-width: 600px;
      margin: auto;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
    }
    .step {
      margin-bottom: 2rem;
      background: white;
      padding: 1.5rem;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .step h2 {
      margin-top: 0;
      font-size: 1.25rem;
      color: var(--primary);
    }
    input[type="text"],
    input[type="password"],
    input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    .day-button {
      margin: 4px;
      padding: 8px 16px;
      border: 1px solid var(--border);
      background: white;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .day-button:hover {
      background: var(--bg);
    }
    .day-button.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    #generateBtn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      width: 100%;
      transition: background 0.2s;
    }
    #generateBtn:hover {
      background: var(--primary-hover);
    }
    #jsonOutput {
      background: #1e293b;
      color: #e2e8f0;
      padding: 1.5rem;
      border-radius: 8px;
      margin-top: 1.5rem;
    }
    #copyBtn {
      background: white;
      color: var(--primary);
      border: 1px solid var(--primary);
      padding: 8px 16px;
      border-radius: 4px;
      margin-top: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    #copyBtn:hover {
      background: var(--primary);
      color: white;
    }
    #quest-header {
      text-align: center;
      margin-bottom: 2rem;
    }
    #quest-header h1 {
      color: var(--primary);
      margin-bottom: 0.5rem;
    }
    .input-group {
      margin-bottom: 1rem;
    }
    small {
      color: #64748b;
    }
    #days-container {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div id="quest-container">

    <div id="quest-header">
      <h1>Commit-Block Quest</h1>
      <p>Block distractions until you push X commits on Github.</p>
    </div>

    <!-- 1. Quest Title -->
    <div class="step">
      <h2>1. Quest Title</h2>
      <input type="text" id="inputQuestTitle" placeholder="e.g. Code Sprint" value="">
    </div>

    <!-- 2. Active Days -->
    <div class="step">
      <h2>2. Active Days</h2>
      <div id="days-container">
        <button class="day-button" data-day="MON">Mon</button>
        <button class="day-button" data-day="TUE">Tue</button>
        <button class="day-button" data-day="WED">Wed</button>
        <button class="day-button" data-day="THU">Thu</button>
        <button class="day-button" data-day="FRI">Fri</button>
        <button class="day-button" data-day="SAT">Sat</button>
        <button class="day-button" data-day="SUN">Sun</button>
      </div>
    </div>

    <!-- 4. Custom Settings -->
    <div class="step">
      <h2>4. Settings</h2>
      <div class="input-group">
        <label for="githubUser">GitHub Username</label>
        <input type="text" id="githubUser" placeholder="your-github-username" required>
      </div>
      <div class="input-group">
        <label for="githubToken">GitHub Token</label>
        <input type="password" id="githubToken" placeholder="github_pat_..." required>
        <small>Create a <a href="https://github.com/settings/tokens" target="_blank">Personal Access Token</a> with 'repo' scope</small>
      </div>
      <div class="input-group">
        <label for="requiredCommits">Required Commits Everyday</label>
        <input type="number" id="requiredCommits" min="1" value="3">
      </div>
    </div>

    <!-- 5. Generate -->
    <div class="step">
      <button id="generateBtn">Generate Configuration</button>
    </div>

    <!-- JSON Output -->
    <div id="jsonOutput" style="display:none;">
      <h3>Copy the JSON below and paste it into QuestPhone</h3>
      <pre id="jsonContent"></pre>
      <button id="copyBtn">Copy JSON</button>
    </div>
  </div>

  <script>
    const selectedDays = new Set();

    document.querySelectorAll('.day-button').forEach(btn => {
      btn.addEventListener('click', () => {
        const d = btn.dataset.day;
        if (selectedDays.has(d)) {
          selectedDays.delete(d);
          btn.classList.remove('active');
        } else {
          selectedDays.add(d);
          btn.classList.add('active');
        }
      });
    });

    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0;
        return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
      });
    }

    document.getElementById('generateBtn').addEventListener('click', () => {
      const title = document.getElementById('inputQuestTitle').value.trim() || 'Commit-Block Quest';
      const githubUser = document.getElementById('githubUser').value.trim();
      const requiredCommits = document.getElementById('requiredCommits').value;

      if (!githubUser) { alert('GitHub username is required'); return; }
      if (selectedDays.size === 0) { alert('Select at least one active day'); return; }

      const startHour = 0;
      const endHour   = 24;

      const githubToken = document.getElementById('githubToken').value.trim();
      if (!githubToken) { alert('GitHub token is required'); return; }
      
      const questJson = JSON.stringify({
        webviewUrl: location.origin + location.pathname.replace('index.html','view.html'), // same repo
        githubUser,
        githubToken,
        requiredCommits: requiredCommits.toString()
      });

      const config = {
        title,
        selected_days: Array.from(selectedDays),
        time_range: [startHour, endHour],
        id: generateUUID(),
        quest_json: questJson,
        integration_id: "EXTERNAL_INTEGRATION",

      };

      const pretty = JSON.stringify(config, null, 2);
      document.getElementById('jsonContent').textContent = pretty;
      document.getElementById('jsonOutput').style.display = 'block';
    });

    document.getElementById('copyBtn').addEventListener('click', () => {
      navigator.clipboard.writeText(document.getElementById('jsonContent').textContent)
        .then(() => alert('Copied! Paste into QuestPhone.'))
        .catch(() => alert('Copy failed'));
    });
  </script>
</body>
</html>